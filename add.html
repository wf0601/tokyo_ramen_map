#reviewModal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 300px; /* Could be more or less, depending on screen size */
}


var markers = {};
{% for marker in markers %}
    var marker = L.marker([{{ marker.location[0] }}, {{ marker.location[1] }}], {
        icon: L.AwesomeMarkers.icon({
            icon: 'info-sign',
            markerColor: '{{ marker.icon_color }}',
        })
    }).bindPopup(`
        <div>
            <strong>{{ marker.popup|safe }}</strong>
        <br>
        <input type='checkbox' id='checkbox_{{ marker.idx }}' onchange='toggleVisited({{ marker.idx }})' {{ 'checked' if marker.visited else '' }}> Visited
        <br>
        </div>
    `).addTo(map);

    markers[{{ marker.idx }}] = { marker: marker, rating: {{ marker.rating }} }; // Store both marker and rating
{% endfor %}
// Function to filter markers based on rating
// function filterMarkersByRating() {
    // const showHighRated = document.getElementById('ratingFilter').checked;

    // for (const idx in markers) {
        // const markerData = markers[idx];
        // const rating = markerData.rating;// Assuming you have the rating available in the marker data

        //if (showHighRated) {
            // Show only markers with rating >= 4.0
            //if (rating >= 4.0) {
             //   markerData.marker.addTo(map);
           // } else {
           //     map.removeLayer(markerData.marker);
           // }
        //} else {
            // Show all markers
        //   markerData.marker.addTo(map);
      //  }
  //  }
//  }

// Add event listener to the checkbox
document.getElementById('ratingFilter').addEventListener('change', filterMarkersByRating);
// Function to toggle visited status
function toggleVisited(idx) {
    fetch(`/toggle_visited/ramen/${idx}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            var marker = markers[idx];
            var iconUrl = data.visited ? 'https://unpkg.com/leaflet.awesome-markers/dist/images/red.png' : 'https://unpkg.com/leaflet.awesome-markers/dist/images/blue.png';
            marker.setIcon(L.AwesomeMarkers.icon({
                icon: 'info-sign',
                markerColor: data.visited ? 'red' : 'blue'
            }));
        }
    });
}

// Function to open the review modal
let currentMarkerIdx = null; // To store the current marker index

function openReviewModal(idx, restaurantName) {
    currentMarkerIdx = idx; // Store the index of the marker
    document.getElementById('reviewText').value = ''; // Clear the review text area
    document.getElementById('reviewModal').style.display = 'block'; // Show the modal
}

// Function to close the review modal
function closeReviewModal() {
    document.getElementById('reviewModal').style.display = 'none'; // Hide the modal
}

// Save review button event listener
document.getElementById('saveReviewButton').addEventListener('click', function() {
    const review = document.getElementById('reviewText').value;
    if (currentMarkerIdx !== null && review) {
        // Send the review to the server
        fetch(`/save_review/ramen/${currentMarkerIdx}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ review: review })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Review saved successfully!');
                closeReviewModal(); // Close the modal
            } else {
                alert('Error saving review: ' + data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    } else {
        alert('Please enter a review.');
    }
});
</script>
</body>
</html>